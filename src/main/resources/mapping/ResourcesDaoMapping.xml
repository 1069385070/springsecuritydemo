<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">  
<mapper namespace="com.study.dao.ResourcesDao">  
	<resultMap type="com.study.model.Resources" id="resourcesMap" autoMapping="true">
		<id property="id" column="id"/>
		<collection property="roles" ofType="com.study.model.Role" autoMapping="true"></collection>
	</resultMap>
	
	<select id="findAllResourcesWithRoles" resultMap="resourcesMap">
		SELECT re.id,re.name,re.parentId,re.resUrl,re.sort,re.type ,ro.roleKey
		FROM t_resources re LEFT JOIN t_role_resources rr
		ON re.id = rr.resourcesId
		LEFT JOIN t_role ro
		ON rr.roleId = ro.id
	</select>
	
		
	<select id="resourcesListWithRole" parameterType="int" resultType="com.study.model.RResources">
		SELECT re.id,re.name,re.parentId,re.resUrl,re.type,
		(CASE WHEN EXISTS(SELECT 1 
		FROM t_role_resources rr WHERE rr.resourcesId=re.id AND rr.roleId=#{rid})
		THEN 'true' ELSE 'false' END) AS checked
		FROM t_resources re
		WHERE re.parentId !=0
		ORDER BY re.sort ASC
	</select>	
	
	<select id="queryAll" parameterType="com.study.model.Resources" resultType="com.study.model.Resources">
		SELECT id,name,parentId,resUrl,type,sort 
		FROM t_resources
		ORDER BY sort ASC  
	</select>
	
	<insert id="addEntity" parameterType="com.study.model.Resources">
		INSERT INTO t_resources(name,parentId,resUrl,type,sort) VALUES(#{name},#{parentId},#{resUrl},#{type},#{sort})
	</insert>

	<delete id="deleteEntity" parameterType="int">
		DELETE FROM t_resources WHERE id = #{id}
	</delete>
		
</mapper> 